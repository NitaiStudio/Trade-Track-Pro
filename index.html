<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0d0d0d">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>TradeTrack Pro | Nitai Studio</title>

    <!-- Icons & Fonts -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #000000;
            --surface: #121212;
            --surface-light: #1e1e1e;
            --primary: #d0bcff;
            --secondary: #b0a1cf;
            --accent: #03dac6;
            --error: #ff8a80;
            --success: #b4eeb4;
            --text-main: #ffffff;
            --text-dim: #938f99;
            --border: rgba(255, 255, 255, 0.1);
            --nav-bg: rgba(18, 18, 18, 0.96);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body, html {
            margin: 0; padding: 0;
            background-color: var(--bg);
            color: var(--text-main);
            font-family: 'Plus Jakarta Sans', sans-serif;
            height: 100%; width: 100%;
            overflow: hidden; /* Prevent body scroll */
        }

        /* Responsive Wrapper */
        .main-wrapper {
            max-width: 500px; /* Desktop-‡¶è ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶≠‡¶ø‡¶â ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø */
            margin: 0 auto;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
            background: var(--bg);
            border-left: 1px solid var(--border);
            border-right: 1px solid var(--border);
        }

        /* Scrollable Area */
        .scroll-container {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 90px; /* Space for nav */
            -webkit-overflow-scrolling: touch;
        }

        /* Splash Screen */
        #splash-screen {
            position: absolute; inset: 0; background: var(--bg); z-index: 10000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        /* Shared UI */
        .card {
            background: var(--surface);
            border-radius: 24px; padding: 20px; margin: 15px;
            border: 1px solid var(--border);
        }

        .btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: #21005d; border: none; padding: 18px; border-radius: 18px;
            font-weight: 800; cursor: pointer; width: 100%; display: flex;
            align-items: center; justify-content: center; gap: 10px; font-size: 16px;
            box-shadow: 0 4px 15px rgba(208, 188, 255, 0.2);
        }

        input, select {
            width: 100%; background: var(--surface-light); border: 1px solid var(--border);
            padding: 16px; border-radius: 16px; color: white; margin-bottom: 6px; font-size: 16px;
        }

        label { display: block; font-size: 13px; color: var(--primary); margin: 12px 0 6px 4px; font-weight: 700; }
        .hint { font-size: 11px; color: var(--text-dim); margin-left: 6px; margin-bottom: 12px; line-height: 1.4; }

        /* Navigation Fixed at Bottom */
        nav {
            position: absolute; bottom: 0; width: 100%; height: 80px;
            background: var(--nav-bg); backdrop-filter: blur(20px);
            display: flex; justify-content: space-around; align-items: center;
            border-top: 1px solid var(--border); z-index: 999;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-item { 
            background: none; border: none; color: var(--text-dim); 
            display: flex; flex-direction: column; align-items: center; 
            cursor: pointer; font-size: 11px; font-weight: 700; flex: 1;
        }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 28px; margin-bottom: 4px; }

        /* Overlays */
        .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.95); z-index: 2000; padding: 20px; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .modal { background: var(--surface); padding: 30px; border-radius: 32px; width: 100%; border: 1px solid var(--border); box-shadow: 0 20px 40px rgba(0,0,0,0.5); }

        .hidden { display: none !important; }
        .screen { display: none; animation: fadeIn 0.4s ease; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        /* Stats */
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 15px; }
        .stat-box { background: var(--surface); padding: 20px; border-radius: 24px; border-bottom: 4px solid var(--primary); }

        /* Badges */
        .support-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .badge { display: flex; align-items: center; justify-content: center; height: 45px; border-radius: 12px; background: var(--surface-light); border: 1px solid var(--border); text-decoration: none; font-size: 12px; color: white; font-weight: 800; }
    </style>
</head>
<body>

    <div class="main-wrapper">
        <!-- 1. Splash Screen -->
        <div id="splash-screen">
            <div style="width:120px; height:120px; background:var(--primary); border-radius:40px; display:flex; align-items:center; justify-content:center; margin-bottom:20px; box-shadow: 0 0 40px rgba(208,188,255,0.3)">
                <i class="material-icons-round" style="font-size:70px; color:#21005d">payments</i>
            </div>
            <h1 style="margin:0; font-size:28px; font-weight:800; letter-spacing:-1px;">TradeTrack Pro</h1>
            <p style="color:var(--text-dim); font-weight:600;">Developed by Nitai Studio</p>
        </div>

        <!-- 2. Language & Login Overlay -->
        <div id="login-overlay" class="overlay hidden">
            <div class="modal">
                <h2 id="l-welcome" style="margin-top:0">Welcome</h2>
                
                <label>Choose Language / ‡¶≠‡¶æ‡¶∑‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®</label>
                <select id="app-lang" onchange="app.updateLanguage()">
                    <option value="en">English (Global)</option>
                    <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (India/BD)</option>
                    <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (India)</option>
                </select>

                <label id="l-country">Country</label>
                <select id="user-country">
                    <option value="+91">üáÆüá≥ India (+91)</option>
                    <option value="+880">üáßüá© Bangladesh (+880)</option>
                    <option value="+1">üá∫üá∏ USA (+1)</option>
                    <option value="+44">üá¨üáß UK (+44)</option>
                    <option value="+971">üá¶üá™ UAE (+971)</option>
                </select>

                <label id="l-phone">Mobile Number</label>
                <input type="tel" id="user-mobile" placeholder="9876543210">
                
                <button class="btn" style="margin-top:25px;" onclick="app.doLogin()" id="l-login-btn">Login</button>
            </div>
        </div>

        <!-- 3. Notice Overlay -->
        <div id="notice-overlay" class="overlay hidden">
            <div class="modal">
                <h2 style="color:var(--error); margin-top:0" id="l-notice-title">Notice</h2>
                <p id="l-notice-text" style="font-size:14px; line-height:1.6; color:var(--text-dim)"></p>
                <button class="btn" onclick="app.acceptNotice()" id="l-notice-btn">Agree & Continue</button>
            </div>
        </div>

        <!-- 4. Content Area -->
        <div class="scroll-container" id="main-content" style="display:none;">
            <header style="padding: 30px 20px 10px 20px;">
                <h1 id="screen-title" style="margin:0; font-size:28px; font-weight:800;">Overview</h1>
                <div id="user-id-tag" style="font-size:12px; color:var(--primary); font-weight:700; margin-top:4px;"></div>
            </header>

            <!-- Screen: Dash -->
            <div id="scr-dash" class="screen">
                <div class="stat-grid">
                    <div class="stat-box">
                        <small id="l-total-inv" style="color:var(--text-dim); font-weight:700; text-transform:uppercase; font-size:10px;">Total Invested</small>
                        <div style="font-size:22px; font-weight:800; margin-top:5px;" id="d-inv">‚Çπ0</div>
                    </div>
                    <div class="stat-box" style="border-bottom-color: var(--accent);">
                        <small id="l-net-pnl" style="color:var(--text-dim); font-weight:700; text-transform:uppercase; font-size:10px;">Net Profit/Loss</small>
                        <div style="font-size:22px; font-weight:800; margin-top:5px;" id="d-pnl">‚Çπ0</div>
                    </div>
                </div>
                <div style="padding:10px 20px;"><h3 id="l-recent-head" style="margin:0; font-size:18px;">Recent Trades</h3></div>
                <div id="list-recent"></div>
            </div>

            <!-- Screen: Add -->
            <div id="scr-add" class="screen">
                <div class="card">
                    <label id="l-date">Trade Date</label>
                    <input type="date" id="t-date">
                    
                    <label id="l-market">Market / Exchange</label>
                    <select id="t-market" onchange="app.updateHints()">
                        <option value="India">Indian Market (NSE/BSE)</option>
                        <option value="Crypto">Crypto (Global)</option>
                        <option value="Forex">Forex (Global)</option>
                        <option value="US">US Market (Nasdaq)</option>
                    </select>

                    <label id="l-symbol">Symbol Name</label>
                    <input type="text" id="t-symbol" placeholder="e.g. BTC, RELIANCE">
                    <div class="hint" id="l-sym-hint">Enter the stock or coin name.</div>

                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px">
                        <div><label id="l-bq">Buy Qty</label><input type="number" id="t-bq" placeholder="0"></div>
                        <div><label id="l-bp">Buy Price</label><input type="number" id="t-bp" placeholder="0.00"></div>
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px">
                        <div><label id="l-sq">Sell Qty</label><input type="number" id="t-sq" placeholder="0"></div>
                        <div><label id="l-sp">Sell Price</label><input type="number" id="t-sp" placeholder="0.00"></div>
                    </div>

                    <button class="btn" style="margin-top:20px" onclick="app.saveEntry()" id="l-save-btn">Save Trade</button>
                </div>
            </div>

            <!-- Screen: History -->
            <div id="scr-history" class="screen">
                <div id="list-history"></div>
            </div>

            <!-- Screen: Settings/Info -->
            <div id="scr-info" class="screen">
                <div class="card" style="text-align:center;">
                    <h2 style="margin:0; color:var(--primary)">Nitai Studio</h2>
                    <p style="font-size:14px; color:var(--text-dim)">Professional Tools for Traders</p>
                    <p style="font-size:13px; background:var(--surface-light); padding:10px; border-radius:12px; margin:20px 0;">
                        <i class="material-icons-round" style="vertical-align:middle; font-size:18px">email</i> nitai.grp00@gmail.com
                    </p>

                    <p style="font-size:11px; font-weight:800; color:var(--accent); text-transform:uppercase;">Donate & Support</p>
                    <div class="support-grid">
                        <a href="https://buymeacoffee.com/nitaigrp00a" class="badge">‚òï Coffee</a>
                        <a href="https://ko-fi.com/nitaisarkar" class="badge">‚ù§Ô∏è Ko-fi</a>
                        <a href="https://www.patreon.com/cw/NitaiStudio" class="badge">üëë Patreon</a>
                        <button class="badge" style="border:none; cursor:pointer;" id="pwa-install-btn">üì≤ Install App</button>
                    </div>

                    <button class="btn" style="margin-top:30px; background:var(--error); color:#000;" onclick="app.logout()">Logout Account</button>
                </div>
            </div>
        </div>

        <!-- Navigation Bar -->
        <nav id="bottom-nav" style="display:none;">
            <button class="nav-item active" onclick="app.navigate('dash')">
                <i class="material-icons-round">dashboard</i><span id="n-dash">Dash</span>
            </button>
            <button class="nav-item" onclick="app.navigate('history')">
                <i class="material-icons-round">history_toggle_off</i><span id="n-history">History</span>
            </button>
            <button class="nav-item" onclick="app.navigate('add')">
                <i class="material-icons-round" style="font-size:40px; color:var(--primary); margin-top:-5px">add_circle</i><span id="n-add">Add</span>
            </button>
            <button class="nav-item" onclick="app.navigate('info')">
                <i class="material-icons-round">info</i><span id="n-info">Info</span>
            </button>
        </nav>
    </div>

    <script>
        const translations = {
            en: { welcome: "Welcome", country: "Country", phone: "Phone Number", login: "Login", notice: "Important Notice", notice_text: "This application is NOT for trading. It is only for personal trade record and calculations. Decisions are your own responsibility.", notice_btn: "I Understand", total_inv: "Total Invested", net_pnl: "Net Profit/Loss", recent: "Recent Trades", date: "Trade Date", market: "Market Type", symbol: "Symbol Name", sym_hint: "Example: BTC, Reliance or Apple", buy_q: "Buy Qty", buy_p: "Buy Price", sell_q: "Sell Qty", sell_p: "Sell Price", save: "Save Trade", n_dash: "Dash", n_history: "History", n_add: "Add", n_info: "Info" },
            bn: { welcome: "‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ", country: "‡¶¶‡ßá‡¶∂", phone: "‡¶´‡ßã‡¶® ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞", login: "‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®", notice: "‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ", notice_text: "‡¶è‡¶á ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶ü‡ßç‡¶∞‡ßá‡¶°‡¶ø‡¶Ç ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡ßü‡•§ ‡¶è‡¶ü‡¶ø ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶ü‡ßç‡¶∞‡ßá‡¶°‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶∞‡¶æ‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø‡•§ ‡¶∏‡¶ï‡¶≤ ‡¶∏‡¶ø‡¶¶‡ßç‡¶ß‡¶æ‡¶®‡ßç‡¶§‡ßá‡¶∞ ‡¶¶‡¶æ‡ßü‡¶ø‡¶§‡ßç‡¶¨ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶ø‡¶ú‡ßá‡¶∞‡•§", notice_btn: "‡¶Ü‡¶Æ‡¶ø ‡¶¨‡ßÅ‡¶ù‡ßá‡¶õ‡¶ø", total_inv: "‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶®‡¶ø‡ßü‡ßã‡¶ó", net_pnl: "‡¶≤‡¶æ‡¶≠ / ‡¶ï‡ßç‡¶∑‡¶§‡¶ø", recent: "‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶ü‡ßç‡¶∞‡ßá‡¶°", date: "‡¶ü‡ßç‡¶∞‡ßá‡¶°‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ", market: "‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü ‡¶ü‡¶æ‡¶á‡¶™", symbol: "‡¶∏‡¶ø‡¶Æ‡ßç‡¶¨‡¶≤ / ‡¶®‡¶æ‡¶Æ", sym_hint: "‡¶Ø‡ßá‡¶Æ‡¶®: BTC, Reliance ‡¶¨‡¶æ Zomato ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§", buy_q: "‡¶ï‡ßá‡¶®‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£", buy_p: "‡¶ï‡ßá‡¶®‡¶æ‡¶∞ ‡¶¶‡¶æ‡¶Æ", sell_q: "‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£", sell_p: "‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶∞ ‡¶¶‡¶æ‡¶Æ", save: "‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®", n_dash: "‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°", n_history: "‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏", n_add: "‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®", n_info: "‡¶§‡¶•‡ßç‡¶Ø" },
            hi: { welcome: "‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à", country: "‡§¶‡•á‡§∂", phone: "‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞", login: "‡§≤‡•â‡§ó‡§ø‡§®", notice: "‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡•Ç‡§ö‡§®‡§æ", notice_text: "‡§Ø‡§π ‡§ê‡§™ ‡§ü‡•ç‡§∞‡•á‡§°‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§Ø‡§π ‡§ï‡•á‡§µ‡§≤ ‡§Ü‡§™‡§ï‡•á ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§ü‡•ç‡§∞‡•á‡§° ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡•à‡•§ ‡§∏‡§≠‡•Ä ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§Ü‡§™‡§ï‡•Ä ‡§Ö‡§™‡§®‡•Ä ‡§ú‡§ø‡§Æ‡•ç‡§Æ‡•á‡§¶‡§æ‡§∞‡•Ä ‡§π‡•à‡§Ç‡•§", notice_btn: "‡§Æ‡•à‡§Ç ‡§∏‡§Æ‡§ù‡§§‡§æ ‡§π‡•Ç‡§Å", total_inv: "‡§ï‡•Å‡§≤ ‡§®‡§ø‡§µ‡•á‡§∂", net_pnl: "‡§∂‡•Å‡§¶‡•ç‡§ß ‡§≤‡§æ‡§≠/‡§π‡§æ‡§®‡§ø", recent: "‡§π‡§æ‡§≤ ‡§ï‡•á ‡§ü‡•ç‡§∞‡•á‡§°", date: "‡§ü‡•ç‡§∞‡•á‡§° ‡§§‡§ø‡§•‡§ø", market: "‡§¨‡§æ‡§ú‡§º‡§æ‡§∞ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞", symbol: "‡§∏‡§ø‡§Ç‡§¨‡§≤ ‡§ï‡§æ ‡§®‡§æ‡§Æ", sym_hint: "‡§â‡§¶‡§æ‡§π‡§∞‡§£: BTC, Reliance ‡§Ø‡§æ Apple", buy_q: "‡§ñ‡§∞‡•Ä‡§¶ ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ", buy_p: "‡§ñ‡§∞‡•Ä‡§¶ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø", sell_q: "‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ", sell_p: "‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§Æ‡•Ç‡§≤‡•ç‡§Ø", save: "‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç", n_dash: "‡§°‡•à‡§∂", n_history: "‡§á‡§§‡§ø‡§π‡§æ‡§∏", n_add: "‡§ú‡•ã‡•ú‡•á‡§Ç", n_info: "‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä" }
        };

        const app = {
            db: null,
            user: null,
            lang: 'en',
            pwaEvent: null,

            init: async function() {
                this.lang = localStorage.getItem('nt_lang') || 'en';
                document.getElementById('app-lang').value = this.lang;
                this.updateLanguage();
                this.setupPWA();
                await this.initDB();

                setTimeout(() => {
                    document.getElementById('splash-screen').style.display = 'none';
                    this.checkAuth();
                }, 2500);
            },

            initDB: function() {
                return new Promise((res) => {
                    const req = indexedDB.open("NitaiStudioFinalDB", 1);
                    req.onupgradeneeded = (e) => e.target.result.createObjectStore("trades", { keyPath: "id", autoIncrement: true });
                    req.onsuccess = (e) => { this.db = e.target.result; res(); };
                });
            },

            setupPWA: function() {
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    this.pwaEvent = e;
                    document.getElementById('pwa-install-btn').style.display = 'flex';
                });
                document.getElementById('pwa-install-btn').onclick = () => {
                    if(this.pwaEvent) this.pwaEvent.prompt();
                };
            },

            updateLanguage: function() {
                this.lang = document.getElementById('app-lang').value;
                localStorage.setItem('nt_lang', this.lang);
                const t = translations[this.lang];
                
                // Update Login/Notice
                document.getElementById('l-welcome').innerText = t.welcome;
                document.getElementById('l-country').innerText = t.country;
                document.getElementById('l-phone').innerText = t.phone;
                document.getElementById('l-login-btn').innerText = t.login;
                document.getElementById('l-notice-title').innerText = t.notice;
                document.getElementById('l-notice-text').innerText = t.notice_text;
                document.getElementById('l-notice-btn').innerText = t.notice_btn;

                // Update UI Labels
                document.getElementById('l-total-inv').innerText = t.total_inv;
                document.getElementById('l-net-pnl').innerText = t.net_pnl;
                document.getElementById('l-recent-head').innerText = t.recent;
                document.getElementById('l-date').innerText = t.date;
                document.getElementById('l-market').innerText = t.market;
                document.getElementById('l-symbol').innerText = t.symbol;
                document.getElementById('l-bq').innerText = t.buy_q;
                document.getElementById('l-bp').innerText = t.buy_p;
                document.getElementById('l-sq').innerText = t.sell_q;
                document.getElementById('l-sp').innerText = t.sell_p;
                document.getElementById('l-save-btn').innerText = t.save;

                // Nav Labels
                document.getElementById('n-dash').innerText = t.n_dash;
                document.getElementById('n-history').innerText = t.n_history;
                document.getElementById('n-add').innerText = t.n_add;
                document.getElementById('n-info').innerText = t.n_info;

                this.updateHints();
            },

            updateHints: function() {
                const m = document.getElementById('t-market').value;
                const hint = document.getElementById('l-sym-hint');
                const t = translations[this.lang];
                if(m === 'India') hint.innerText = this.lang === 'bn' ? "‡¶Ø‡ßá‡¶Æ‡¶®: RELIANCE, ZOMATO ‡¶¨‡¶æ SBIN ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§" : t.sym_hint;
                else if(m === 'Crypto') hint.innerText = this.lang === 'bn' ? "‡¶Ø‡ßá‡¶Æ‡¶®: BTC, ETH ‡¶¨‡¶æ SOL ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§" : "Example: BTC, ETH or SOL";
                else hint.innerText = t.sym_hint;
            },

            checkAuth: function() {
                const u = localStorage.getItem('nt_user');
                const n = localStorage.getItem('nt_notice');
                if(!u) document.getElementById('login-overlay').classList.remove('hidden');
                else if(!n) {
                    this.user = u;
                    document.getElementById('notice-overlay').classList.remove('hidden');
                } else {
                    this.user = u;
                    this.startApp();
                }
            },

            doLogin: function() {
                const p = document.getElementById('user-mobile').value.trim();
                const c = document.getElementById('user-country').value;
                if(p.length < 5) return alert("Enter valid number");
                localStorage.setItem('nt_user', c + p);
                location.reload();
            },

            acceptNotice: function() {
                localStorage.setItem('nt_notice', 'true');
                location.reload();
            },

            startApp: function() {
                document.getElementById('main-content').style.display = 'block';
                document.getElementById('bottom-nav').style.display = 'flex';
                document.getElementById('user-id-tag').innerText = "ID: " + this.user;
                this.navigate('dash');
            },

            navigate: function(id) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById('scr-' + id).classList.add('active');
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                
                const map = {dash:0, history:1, add:2, info:3};
                document.querySelectorAll('.nav-item')[map[id]].classList.add('active');
                
                const titles = {dash:'Overview', add:'New Trade', history:'All Logs', info:'About'};
                document.getElementById('screen-title').innerText = titles[id];
                
                if(id === 'dash' || id === 'history') this.loadData();
                document.getElementById('main-content').scrollTop = 0;
            },

            loadData: function() {
                const tx = this.db.transaction("trades", "readonly");
                const store = tx.objectStore("trades");
                const req = store.getAll();
                req.onsuccess = () => {
                    const data = req.result.filter(t => t.uid === this.user).sort((a,b) => b.ts - a.ts);
                    this.render(data);
                };
            },

            saveEntry: function() {
                const bq = parseFloat(document.getElementById('t-bq').value) || 0;
                const bp = parseFloat(document.getElementById('t-bp').value) || 0;
                const sq = parseFloat(document.getElementById('t-sq').value) || 0;
                const sp = parseFloat(document.getElementById('t-sp').value) || 0;
                const sym = document.getElementById('t-symbol').value.toUpperCase().trim();

                if(!sym) return alert("Symbol required");

                const entry = {
                    uid: this.user,
                    date: document.getElementById('t-date').value || new Date().toISOString().split('T')[0],
                    sym: sym,
                    pnl: (sq * sp) - (bq * bp),
                    inv: (bq * bp),
                    ts: Date.now()
                };

                const tx = this.db.transaction("trades", "readwrite");
                tx.objectStore("trades").add(entry);
                tx.oncomplete = () => {
                    alert("Trade Saved Successfully!");
                    this.clearAddForm();
                    this.navigate('dash');
                };
            },

            clearAddForm: function() {
                document.getElementById('t-symbol').value = '';
                document.getElementById('t-bq').value = '';
                document.getElementById('t-bp').value = '';
                document.getElementById('t-sq').value = '';
                document.getElementById('t-sp').value = '';
            },

            render: function(data) {
                const totalInv = data.reduce((s, t) => s + t.inv, 0);
                const totalPnl = data.reduce((s, t) => s + t.pnl, 0);

                document.getElementById('d-inv').innerText = "‚Çπ" + totalInv.toLocaleString();
                const pnlEl = document.getElementById('d-pnl');
                pnlEl.innerText = (totalPnl >= 0 ? '+' : '') + "‚Çπ" + totalPnl.toLocaleString();
                pnlEl.style.color = totalPnl >= 0 ? 'var(--success)' : 'var(--error)';

                const itemHTML = (t) => `
                    <div class="card" style="margin:8px 15px; display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <div style="font-weight:800; font-size:16px;">${t.sym}</div>
                            <div style="font-size:11px; color:var(--text-dim)">${t.date}</div>
                        </div>
                        <div style="text-align:right">
                            <div style="font-weight:800; color:${t.pnl >= 0 ? 'var(--success)' : 'var(--error)'}">
                                ${t.pnl >= 0 ? '+' : ''}${t.pnl.toFixed(2)}
                            </div>
                        </div>
                    </div>`;

                document.getElementById('list-recent').innerHTML = data.slice(0, 5).map(itemHTML).join('');
                document.getElementById('list-history').innerHTML = data.map(itemHTML).join('');
            },

            logout: function() {
                if(confirm("Logout? Data remains on this device.")){
                    localStorage.clear();
                    location.reload();
                }
            }
        };

        window.onload = () => {
            app.init();
            document.getElementById('t-date').valueAsDate = new Date();
        };

        // PWA Config
        const manifest = {
            "name": "TradeTrack Pro", "short_name": "TradeTrack", "start_url": "./",
            "display": "standalone", "background_color": "#000000", "theme_color": "#0d0d0d",
            "icons": [{"src": "https://cdn-icons-png.flaticon.com/512/2422/2422796.png", "sizes": "512x512", "type": "image/png"}]
        };
        const mLink = document.createElement('link');
        mLink.rel = 'manifest';
        mLink.href = URL.createObjectURL(new Blob([JSON.stringify(manifest)], {type: 'application/json'}));
        document.head.appendChild(mLink);

        if ('serviceWorker' in navigator) {
            const sw = `self.addEventListener('fetch', e => e.respondWith(caches.match(e.request).then(r => r || fetch(e.request))));`;
            navigator.serviceWorker.register(URL.createObjectURL(new Blob([sw], {type: 'application/javascript'})));
        }
    </script>
</body>
</html>